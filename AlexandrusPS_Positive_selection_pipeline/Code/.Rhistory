mutate(M7_M8_LRT=2*(M8_lnL-M7_lnL)) %>%
mutate(M0_M3_sig = pchisq(M0_M3_LRT, M0_M3_DoF, lower.tail=T)) %>%
mutate(M1_M2_sig = pchisq(M1_M2_LRT, M1_M2_DoF, lower.tail=T)) %>%
mutate(M7_M8_sig = pchisq(M7_M8_LRT, M7_M8_DoF, lower.tail=T)) #%>%
test <- adjust_pvalue(as.data.frame(test),p.col="M7_M8_sig",method="fdr")
test %>% filter(category1=="Caenorhabditis") %>% ggplot(aes(x=-log10(M7_M8_sig.adj))) + geom_density() +
geom_density(data=test %>% filter(category1!="Caenorhabditis"),aes(x=-log10(M7_M8_sig.adj)))
test %>% filter(category1=="Caenorhabditis") %>% mutate(stats=ifelse(M7_M8_sig.adj<0.05,"GUPS","noGUP")) %>% pull(stats) %>% table()
test %>% filter(category2=="Eurhabditis") %>% mutate(stats=ifelse(M7_M8_sig.adj<0.05,"GUPS","noGUP")) %>% pull(stats) %>% table()
PosCaeno <- test %>% filter(M7_M8_sig < 0.05 && M8_w > 1)
PurCaeno <- test %>% filter(M1_M2_sig < 0.05 && M1_p0 > 0.9 && M1_w0 < 0.005)
View(PosCaeno)
#PositiveSelectionTable <- read.delim("~/PhD/Data/Nematode_Data/z17_Positive_Selection_Table_AC-B0000171/PositiveSelectionTable.txt.clean.txt.sort.uniq.txt.OnlyOneEntry.txt.header.txt", stringsAsFactors=FALSE)
PositiveSelectionTable <- read.delim("/home/alejandro/PhD/Code/AC-B0000184_Positive_Selection_cinop/Final_table_positive_selection/Tables_old/PositiveSelectionTable.txt", stringsAsFactors=FALSE)
colnames(PositiveSelectionTable) <- c("ID","Species","M0_lnL","M0_np", "M0_w","M1_lnL","M1_np", "M1_p0", "M1_p1", "M1_w0", "M1_w1", "M2_lnL","M2_np", "M3_lnL","M3_np","M7_lnL","M7_np", "M7_p","M7_q","M8_lnL","M8_np", "M8_p0", "M8_p","M8_q","M8_p1", "M8_w","M0_PSS","M1_PSS","M2_PSS","M3_PSS","M7_PSS","M8_PSS")
caeno <- c("cbrenneri","cbriggsae","celegans","cinopinata","cjaponica","cremanei","DF5112")
outgroup <- c("CEW1","DF5006", "DF5012","MT8872","ppacificus")
PositiveSelectionTable <- PositiveSelectionTable %>% rowwise() %>% mutate(category=case_when(
all(unlist(strsplit(Species,split=",")) %in% caeno) ~ "Caenorhabditis",
all(unlist(strsplit(Species,split=",")) %in% outgroup) ~ "Outgroup",
TRUE ~ "Mixed"
))
median <- PositiveSelectionTable %>%
select(category,M0_w) %>%
group_by(category) %>%  summarize(median=median(M0_w))
PositiveSelectionTable %>%
select(category,M0_w) %>%
ggplot(aes(x=M0_w,group=category,fill=category)) +
#geom_histogram(aes(y=..density..), colour="black", fill="white",binwidth=0.005)+
geom_density(alpha=.2#, fill="#FF6666"
) +
theme_bw() +
theme(legend.position="bottom")+
geom_vline(data = median, aes(xintercept = median,color = category), size=0.5,linetype="dashed")
## incremental Positive selection ####
#PositiveSelectionTable <- read.delim("~/PhD/Data/Nematode_Data/z17_Positive_Selection_Table_AC-B0000171/PositiveSelectionTable.txt.clean.txt.sort.uniq.txt.OnlyOneEntry.txt.header.txt", stringsAsFactors=FALSE)
PositiveSelectionTable <- read.delim("/home/alejandro/PhD/Code/AC-B0000178_Positive_Selection_Chrismas/Final_table_positive_selection/PositiveSelectionTable.txt", stringsAsFactors=FALSE)
## incremental Positive selection ####
#PositiveSelectionTable <- read.delim("~/PhD/Data/Nematode_Data/z17_Positive_Selection_Table_AC-B0000171/PositiveSelectionTable.txt.clean.txt.sort.uniq.txt.OnlyOneEntry.txt.header.txt", stringsAsFactors=FALSE)
PositiveSelectionTable <- read.delim("/home/alejandro/PhD/Code/AC-B0000184_Positive_Selection_cinop/Final_table_positive_selection/Tables_old/PositiveSelectionTable.txt", stringsAsFactors=FALSE)
colnames(PositiveSelectionTable) <- c("ID","Species","M0_lnL","M0_np", "M0_w","M1_lnL","M1_np", "M1_p0", "M1_p1", "M1_w0", "M1_w1", "M2_lnL","M2_np", "M3_lnL","M3_np","M7_lnL","M7_np", "M7_p","M7_q","M8_lnL","M8_np", "M8_p0", "M8_p","M8_q","M8_p1", "M8_w","M0_PSS","M1_PSS","M2_PSS","M3_PSS","M7_PSS","M8_PSS")
caeno <- c("cbrenneri","cbriggsae","celegans","cinopinata","cjaponica","cremanei","DF5112")
eurhabditis <- c("cbrenneri","cbriggsae","celegans","cinopinata","cjaponica","cremanei","DF5112","CEW1","DF5006")
#all <-              "DF5012","MT8872","ppacificus")
PositiveSelectionTable <- PositiveSelectionTable %>% rowwise() %>% mutate(category1=case_when(
all(unlist(strsplit(Species,split=",")) %in% caeno) ~ "Caenorhabditis",
TRUE ~ "Mixed"
)) %>% mutate(category2=case_when(
all(unlist(strsplit(Species,split=",")) %in% eurhabditis) ~ "Eurhabditis",
TRUE ~ "Mixed"
)) %>% mutate(category3="ALL")
median <- rbind(PositiveSelectionTable %>%
group_by(category1) %>%  summarize(median1=median(M0_w)) %>% rename(category=category1) %>% rename(median=median1),
PositiveSelectionTable %>%
group_by(category2) %>%  summarize(median2=median(M0_w)) %>% rename(category=category2) %>% rename(median=median2),
as_tibble(cbind("ALL",PositiveSelectionTable %>% pull(M0_w) %>% median())) %>% rename(category=V1) %>% rename(median=V2))
PositiveSelectionTable %>%
select(category1,M0_w) %>%
filter(category1=="Caenorhabditis") %>%
ggplot(aes(x=M0_w,group=category1,fill=category1)) +
#geom_histogram(aes(y=..density..), colour="black", fill="white",binwidth=0.005)+
geom_density(alpha=.2#, fill="#FF6666"
) +
geom_density(data=PositiveSelectionTable %>%
select(category2,M0_w) %>%
filter(category2=="Eurhabditis"),aes(x=M0_w,group=category2,fill=category2),
alpha=.2#, fill="#FF6666"
) +
geom_density(data=PositiveSelectionTable %>%
select(category3,M0_w)
,aes(x=M0_w ,group=category3,fill=category3
),
alpha=.2#, fill="#FF6666"
) +
theme_bw() +
theme(legend.position="bottom")+
labs(fill='Orthology subgroups') +
geom_vline(data = median %>% slice(c(1,3,5)), aes(xintercept = as.numeric(median),color = category), size=0.5,linetype="dashed", show.legend = F)
test <- PositiveSelectionTable %>% rowwise() %>%
mutate(M0_M3_DoF=(M3_np-M0_np)) %>%
mutate(M0_M3_LRT=2*(M3_lnL-M0_lnL)) %>%
mutate(M1_M2_DoF=(M2_np-M1_np)) %>%
mutate(M1_M2_LRT=2*(M2_lnL-M1_lnL)) %>%
mutate(M7_M8_DoF=(M8_np-M7_np)) %>%
mutate(M7_M8_LRT=2*(M8_lnL-M7_lnL)) %>%
mutate(M0_M3_sig = pchisq(M0_M3_LRT, M0_M3_DoF, lower.tail=T)) %>%
mutate(M1_M2_sig = pchisq(M1_M2_LRT, M1_M2_DoF, lower.tail=T)) %>%
mutate(M7_M8_sig = pchisq(M7_M8_LRT, M7_M8_DoF, lower.tail=T)) #%>%
test <- adjust_pvalue(as.data.frame(test),p.col="M7_M8_sig",method="fdr")
View(test)
test %>% filter(category1=="Caenorhabditis") %>% ggplot(aes(x=-log10(M7_M8_sig.adj))) + geom_density() +
geom_density(data=test %>% filter(category1!="Caenorhabditis"),aes(x=-log10(M7_M8_sig.adj)))
test %>% filter(category1=="Caenorhabditis") %>% mutate(stats=ifelse(M7_M8_sig.adj<0.05,"GUPS","noGUP")) %>% pull(stats) %>% table()
test %>% filter(category2=="Eurhabditis") %>% mutate(stats=ifelse(M7_M8_sig.adj<0.05,"GUPS","noGUP")) %>% pull(stats) %>% table()
PosCaeno <- test %>% filter(M7_M8_sig < 0.05 && M8_w > 1)
PosCaeno <- test %>% filter(M7_M8_sig < 0.05 & M8_w > 1)
test <- PositiveSelectionTable %>% rowwise() %>%
mutate(M0_M3_DoF=(M3_np-M0_np)) %>%
mutate(M0_M3_LRT=2*(M3_lnL-M0_lnL)) %>%
mutate(M1_M2_DoF=(M2_np-M1_np)) %>%
mutate(M1_M2_LRT=2*(M2_lnL-M1_lnL)) %>%
mutate(M7_M8_DoF=(M8_np-M7_np)) %>%
mutate(M7_M8_LRT=2*(M8_lnL-M7_lnL)) %>%
mutate(M0_M3_sig = pchisq(M0_M3_LRT, M0_M3_DoF, lower.tail=F)) %>%
mutate(M1_M2_sig = pchisq(M1_M2_LRT, M1_M2_DoF, lower.tail=F)) %>%
mutate(M7_M8_sig = pchisq(M7_M8_LRT, M7_M8_DoF, lower.tail=F)) #%>%
test <- adjust_pvalue(as.data.frame(test),p.col="M7_M8_sig",method="fdr")
test %>% filter(category1=="Caenorhabditis") %>% ggplot(aes(x=-log10(M7_M8_sig.adj))) + geom_density() +
geom_density(data=test %>% filter(category1!="Caenorhabditis"),aes(x=-log10(M7_M8_sig.adj)))
test %>% filter(category1=="Caenorhabditis") %>% mutate(stats=ifelse(M7_M8_sig.adj<0.05,"GUPS","noGUP")) %>% pull(stats) %>% table()
test %>% filter(category2=="Eurhabditis") %>% mutate(stats=ifelse(M7_M8_sig.adj<0.05,"GUPS","noGUP")) %>% pull(stats) %>% table()
PosCaeno <- test %>% filter(M7_M8_sig < 0.05 & M8_w > 1)
PurCaeno <- test %>% filter(M1_M2_sig < 0.05 & M1_p0 > 0.9 & M1_w0 < 0.005)
View(PosCaeno)
View(PositiveSelectionTable)
write.table(PosCaeno %>% pull(ID),file="PosCaeno.txt", quote = F,row.names = F,col.names = F)
##Caeno####
PositiveSelectionTable <- read.delim("~/PhD/Data/Nematode_Data/z17_Positive_Selection_Table_AC-B0000171/PositiveSelectionTable.txt.clean.txt.sort.uniq.txt.OnlyOneEntry.txt.header.txt", stringsAsFactors=FALSE)
library(dplyr)
library(ggplot2)
library(caret)
library(reshape2)
library(ggpubr)
library(RColorBrewer)
library(stringr)
library(viridis)
library(ggpubr)
library(rstatix)
##Caeno####
PositiveSelectionTable <- read.delim("~/PhD/Data/Nematode_Data/z17_Positive_Selection_Table_AC-B0000171/PositiveSelectionTable.txt.clean.txt.sort.uniq.txt.OnlyOneEntry.txt.header.txt", stringsAsFactors=FALSE)
##Caeno####
PositiveSelectionTable <- read.delim("/home/alejandro/PhD/Data/Nematode_Data/z17_Positive_Selection_Table_AC-B0000184/PositiveSelectionTable.txt", stringsAsFactors=FALSE)
colnames(PositiveSelectionTable) <- c("ID","Species","M0_lnL","M0_np", "M0_w","M1_lnL","M1_np", "M1_p0", "M1_p1", "M1_w0", "M1_w1", "M2_lnL","M2_np", "M3_lnL","M3_np","M7_lnL","M7_np", "M7_p","M7_q","M8_lnL","M8_np", "M8_p0", "M8_p","M8_q","M8_p1", "M8_w","M0_PSS","M1_PSS","M2_PSS","M3_PSS","M7_PSS","M8_PSS")
caeno <- c("cbrenneri","cbriggsae","celegans","cinopinata","cjaponica","cremanei","DF5112")
outgroup <- c("CEW1","DF5006", "DF5012","MT8872","ppacificus")
PositiveSelectionTable <- PositiveSelectionTable %>% rowwise() %>% mutate(category=case_when(
all(unlist(strsplit(Species,split=",")) %in% caeno) ~ "Caenorhabditis",
all(unlist(strsplit(Species,split=",")) %in% outgroup) ~ "Outgroup",
TRUE ~ "Mixed"
))
median <- PositiveSelectionTable %>%
select(category,M0_w) %>%
group_by(category) %>%  summarize(median=median(M0_w))
PositiveSelectionTable %>%
select(category,M0_w) %>%
ggplot(aes(x=M0_w,group=category,fill=category)) +
#geom_histogram(aes(y=..density..), colour="black", fill="white",binwidth=0.005)+
geom_density(alpha=.2#, fill="#FF6666"
) +
theme_bw() +
theme(legend.position="bottom")+
geom_vline(data = median, aes(xintercept = median,color = category), size=0.5,linetype="dashed")
## incremental Positive selection ####
PositiveSelectionTable <- read.delim("/home/alejandro/PhD/Data/Nematode_Data/z17_Positive_Selection_Table_AC-B0000184/PositiveSelectionTable.txt", stringsAsFactors=FALSE)
#PositiveSelectionTable <- read.delim("/home/alejandro/PhD/Code/AC-B0000178_Positive_Selection_Chrismas/Final_table_positive_selection/PositiveSelectionTable.txt", stringsAsFactors=FALSE)
#PositiveSelectionTable <- read.delim("/home/alejandro/PhD/Code/AC-B0000180_Positive_Selection_branchModel_AC178/Results/PositiveSelectionTable.txt", stringsAsFactors=FALSE)
colnames(PositiveSelectionTable) <- c("ID","Species","M0_lnL","M0_np", "M0_w","M1_lnL","M1_np", "M1_p0", "M1_p1", "M1_w0", "M1_w1", "M2_lnL","M2_np", "M3_lnL","M3_np","M7_lnL","M7_np", "M7_p","M7_q","M8_lnL","M8_np", "M8_p0", "M8_p","M8_q","M8_p1", "M8_w","M0_PSS","M1_PSS","M2_PSS","M3_PSS","M7_PSS","M8_PSS")
caeno <- c("cbrenneri","cbriggsae","celegans","cinopinata","cjaponica","cremanei","DF5112")
eurhabditis <- c("cbrenneri","cbriggsae","celegans","cinopinata","cjaponica","cremanei","DF5112","CEW1","DF5006")
#all <-              "DF5012","MT8872","ppacificus")
PositiveSelectionTable <- PositiveSelectionTable %>% rowwise() %>% mutate(category1=case_when(
all(unlist(strsplit(Species,split=",")) %in% caeno) ~ "Caenorhabditis",
TRUE ~ "Mixed"
)) %>% mutate(category2=case_when(
all(unlist(strsplit(Species,split=",")) %in% eurhabditis) ~ "Eurhabditis",
TRUE ~ "Mixed"
)) %>% mutate(category3="ALL")
View(PositiveSelectionTable)
median <- rbind(PositiveSelectionTable %>%
group_by(category1) %>%  summarize(median1=median(M0_w)) %>% rename(category=category1) %>% rename(median=median1),
PositiveSelectionTable %>%
group_by(category2) %>%  summarize(median2=median(M0_w)) %>% rename(category=category2) %>% rename(median=median2),
as_tibble(cbind("ALL",PositiveSelectionTable %>% pull(M0_w) %>% median())) %>% rename(category=V1) %>% rename(median=V2))
PositiveSelectionTable %>%
select(category1,M0_w) %>%
filter(category1=="Caenorhabditis") %>%
ggplot(aes(x=M0_w,group=category1,fill=category1)) +
#geom_histogram(aes(y=..density..), colour="black", fill="white",binwidth=0.005)+
geom_density(alpha=.2#, fill="#FF6666"
) +
geom_density(data=PositiveSelectionTable %>%
select(category2,M0_w) %>%
filter(category2=="Eurhabditis"),aes(x=M0_w,group=category2,fill=category2),
alpha=.2#, fill="#FF6666"
) +
geom_density(data=PositiveSelectionTable %>%
select(category3,M0_w)
,aes(x=M0_w ,group=category3,fill=category3
),
alpha=.2#, fill="#FF6666"
) +
theme_bw() +
theme(legend.position="bottom")+
labs(fill='Orthology subgroups') +
geom_vline(data = median %>% slice(c(1,3,5)), aes(xintercept = as.numeric(median),color = category), size=0.5,linetype="dashed", show.legend = F)
test <- PositiveSelectionTable %>% rowwise() %>%
mutate(M0_M3_DoF=(M3_np-M0_np)) %>%
mutate(M0_M3_LRT=2*(M3_lnL-M0_lnL)) %>%
mutate(M1_M2_DoF=(M2_np-M1_np)) %>%
mutate(M1_M2_LRT=2*(M2_lnL-M1_lnL)) %>%
mutate(M7_M8_DoF=(M8_np-M7_np)) %>%
mutate(M7_M8_LRT=2*(M8_lnL-M7_lnL)) %>%
mutate(M0_M3_sig = pchisq(M0_M3_LRT, M0_M3_DoF, lower.tail=F)) %>%
mutate(M1_M2_sig = pchisq(M1_M2_LRT, M1_M2_DoF, lower.tail=F)) %>%
mutate(M7_M8_sig = pchisq(M7_M8_LRT, M7_M8_DoF, lower.tail=F)) #%>%
View(test)
#test <- adjust_pvalue(as.data.frame(test),p.col="M7_M8_sig",method="fdr")
test <- adjust_pvalue(as.data.frame(test),p.col="M7_M8_sig",method="holm")
test %>% filter(category1=="Caenorhabditis") %>% ggplot(aes(x=-log10(M7_M8_sig.adj))) + geom_density() +
geom_density(data=test %>% filter(category1!="Caenorhabditis"),aes(x=-log10(M7_M8_sig.adj)))
test %>% filter(category1=="Caenorhabditis") %>% mutate(stats=ifelse(M7_M8_sig.adj<0.05,"GUPS","noGUP")) %>% pull(stats) %>% table()
test %>% filter(category2=="Eurhabditis") %>% mutate(stats=ifelse(M7_M8_sig.adj<0.05,"GUPS","noGUP")) %>% pull(stats) %>% table()
#PosCaeno <- test %>% filter(M7_M8_sig < 0.05 & M8_w > 1)
PosCaeno <- test %>% filter(M7_M8_sig.adj < 0.05 & M8_w > 1)
PurCaeno <- test %>% filter(M1_M2_sig < 0.05 & M1_p0 > 0.9 & M1_w0 < 0.05)
write.table(PosCaeno %>% pull(ID),file="/home/alejandro/PhD/Data/Nematode_Data/z17_Positive_Selection_Table_AC-B0000184/GenesUnderPositiveSelectionCaenorhabditis.txt", quote = F,row.names = F,col.names = F)
View(PurCaeno)
## incremental Positive selection ####
PositiveSelectionTable <- read.delim("../Final_table_positive_selection/PositiveSelectionTable.txt", stringsAsFactors=FALSE)
View(PositiveSelectionTable)
####Branch####
#Branch_models_Table <- read.delim("~/PhD/Data/Nematode_Data/z17_Positive_Selection_Table_AC-B0000192/Branch_models_BranchSite_models_Table.txt", stringsAsFactors=FALSE)
Branch_models_Table <- read.delim("../Branch_models/Branch_models_BranchSite_models_Table.txt", stringsAsFactors=FALSE)
BS_analysis <- Branch_models_Table %>% rowwise() %>%
mutate(M0_bM0_DoF=(bsM0_np-M0_np)) %>%
mutate(M0_bM0_LRT=2*(bsM0_lnL-M0_lnL)) %>%
mutate(bsM0H1_bsM0H0_DoF=(bsM0H1_np-bsM0H0_np)) %>%
mutate(bsM0H1_bsM0H0_LRT=2*(bsM0H1_lnL-bsM0H0_lnL)) %>%
mutate(M0_bM0_sig = pchisq(M0_bM0_LRT, M0_bM0_DoF, lower.tail=F)) %>%
mutate(bsM0H1_bsM0H0_sig = pchisq(bsM0H1_bsM0H0_LRT, bsM0H1_bsM0H0_DoF, lower.tail=F)) #%>%
library(dplyr)
library(ggplot2)
library(caret)
library(reshape2)
library(ggpubr)
library(RColorBrewer)
library(stringr)
library(viridis)
library(ggpubr)
library(rstatix)
####Branch####
#Branch_models_Table <- read.delim("~/PhD/Data/Nematode_Data/z17_Positive_Selection_Table_AC-B0000192/Branch_models_BranchSite_models_Table.txt", stringsAsFactors=FALSE)
Branch_models_Table <- read.delim("../Branch_models/Branch_models_BranchSite_models_Table.txt", stringsAsFactors=FALSE)
BS_analysis <- Branch_models_Table %>% rowwise() %>%
mutate(M0_bM0_DoF=(bsM0_np-M0_np)) %>%
mutate(M0_bM0_LRT=2*(bsM0_lnL-M0_lnL)) %>%
mutate(bsM0H1_bsM0H0_DoF=(bsM0H1_np-bsM0H0_np)) %>%
mutate(bsM0H1_bsM0H0_LRT=2*(bsM0H1_lnL-bsM0H0_lnL)) %>%
mutate(M0_bM0_sig = pchisq(M0_bM0_LRT, M0_bM0_DoF, lower.tail=F)) %>%
mutate(bsM0H1_bsM0H0_sig = pchisq(bsM0H1_bsM0H0_LRT, bsM0H1_bsM0H0_DoF, lower.tail=F)) #%>%
View(Branch_models_Table)
library(dplyr)
library(ggplot2)
library(caret)
library(reshape2)
library(ggpubr)
library(RColorBrewer)
library(stringr)
library(viridis)
library(ggpubr)
library(rstatix)
####Branch####
#Branch_models_Table <- read.delim("~/PhD/Data/Nematode_Data/z17_Positive_Selection_Table_AC-B0000192/Branch_models_BranchSite_models_Table.txt", stringsAsFactors=FALSE)
Branch_models_Table <- read.delim("../Branch_models/Branch_models_BranchSite_models_Table.txt", stringsAsFactors=FALSE)
View(Branch_models_Table)
BS_analysis <- Branch_models_Table %>% rowwise() %>%
mutate(M0_bM0_DoF=(bsM0_np-M0_np)) %>%
mutate(M0_bM0_LRT=2*(bsM0_lnL-M0_lnL)) %>%
mutate(bsM0H1_bsM0H0_DoF=(bsM0H1_np-bsM0H0_np)) %>%
mutate(bsM0H1_bsM0H0_LRT=2*(bsM0H1_lnL-bsM0H0_lnL)) %>%
mutate(M0_bM0_sig = pchisq(M0_bM0_LRT, M0_bM0_DoF, lower.tail=F)) %>%
mutate(bsM0H1_bsM0H0_sig = pchisq(bsM0H1_bsM0H0_LRT, bsM0H1_bsM0H0_DoF, lower.tail=F)) #%>%
Branch_model <- BS_analysis %>% filter(M0_bM0_sig < 0.05)
Branch_site <- BS_analysis %>% filter(bsM0H1_bsM0H0_sig < 0.05)
View(Branch_site)
write.table(Branch_model %>% pull(ID),file="./Branch_model.txt", quote = F,row.names = F,col.names = F)
write.table(Branch_site %>% pull(ID),file="./Branch_site_model.txt", quote = F,row.names = F,col.names = F)
write.table(Branch_model %>% pull(ID),file="../Branch_models/Branch_model.txt", quote = F,row.names = F,col.names = F)
write.table(Branch_site %>% pull(ID),file="../Branch_models/Branch_site_model.txt", quote = F,row.names = F,col.names = F)
write.table(Branch_model ,file="../Branch_models/Branch_model.txt", quote = F,row.names = F,col.names = F)
write.table(Branch_site ,file="../Branch_models/Branch_site_model.txt", quote = F,row.names = F,col.names = F)
write.table(Branch_model ,file="../Branch_models/Branch_model.txt", quote = F,row.names = F,col.names = T)
write.table(Branch_site ,file="../Branch_models/Branch_site_model.txt", quote = F,row.names = F,col.names = T)
Branch_site %>% rowwise() %>%
mutate(List=unlist(strsplit(Branch_site,split="_"))[2])
Branch_site %>% rowwise() %>%
mutate(Branch_site=unlist(strsplit(Branch_site,split="_"))[2])
Branch_site %>%
rowwise()  %>% select(Branch_site) %>% separate_rows(Branch_site, sep = "_")
library(biomaRt)
library(dplyr)
library(ggplot2)
library(caret)
library(reshape2)
library(ggpubr)
library(RColorBrewer)
library(stringr)
library(viridis)
library(ggpubr)
library(tidyr)
Branch_site %>%
rowwise()  %>% select(Branch_site) %>% separate_rows(Branch_site, sep = "_")
Branch_site %>%
rowwise()  %>% select(ID) %>% separate_rows(ID, sep = "_")
View(Branch_site)
Branch_site %>% rowwise() %>%
mutate(ID=unlist(strsplit(ID,split="_"))[2])
Branch_site %>% rowwise() %>%
mutate(ID=unlist(strsplit(ID,split="_"))[2]) %>% pull(ID)
write.table(Branch_site %>% rowwise() %>% mutate(ID=unlist(strsplit(ID,split="_"))[2]) %>% pull(ID),file="../Branch_models/Branch_model_ID.txt", quote = F,row.names = F,col.names = F)
write.table(Branch_model ,file="../Branch_models/Branch_model.txt", quote = F,row.names = F,col.names = T)
write.table(Branch_site ,file="../Branch_models/Branch_site_model.txt", quote = F,row.names = F,col.names = T)
write.table(Branch_model %>% rowwise() %>% mutate(ID=unlist(strsplit(ID,split="_"))[2]) %>% pull(ID),file="../Branch_models/Branch_model_ID.txt", quote = F,row.names = F,col.names = F)
write.table(Branch_site %>% rowwise() %>% mutate(ID=unlist(strsplit(ID,split="_"))[2]) %>% pull(ID),file="../Branch_models/Branch_site_model_ID.txt", quote = F,row.names = F,col.names = F)
View(PositiveSelectionTable)
##prim####
PositiveSelectionTable <- read.delim("../Final_table_positive_selection/PositiveSelectionTable.txt", header=FALSE, stringsAsFactors=FALSE)
View(PositiveSelectionTable)
# TableS5_934_PSR <- read.delim("~/PhD/Code/AL/0_PaperII/AC-PS000001_Positive_selection_9_primates_V2/Final_table_positive_selection/TableS5__934_PSR__info_statistics.txt", stringsAsFactors=FALSE)
# TableS4_331_PSG <- read.delim("~/PhD/Code/AL/0_PaperII/AC-PS000001_Positive_selection_9_primates_V2/Final_table_positive_selection/TableS4__331_PSG__info_statistics.txt", stringsAsFactors=FALSE)
# Dictionary <- read.delim("~/PhD/Code/AL/0_PaperII/AC-PS000001_Positive_selection_9_primates_V2/Prepare_files/Dictionary/AC-PS000001_Dictionary.txt", stringsAsFactors=FALSE)
# Test <- read.delim("~/PhD/Code/AL/0_PaperII/AC-PS000002_Positive_selection_9_primates_V1/Test.txt", header=FALSE, stringsAsFactors=FALSE)
# colnames(Test) <- c("ID","Species","M0_lnL","M0_np", "M0_w","M1_lnL","M1_np", "M1_p0", "M1_p1", "M1_w0", "M1_w1", "M2_lnL","M2_np", "M3_lnL","M3_np","M7_lnL","M7_np", "M7_p","M7_q","M8_lnL","M8_np", "M8_p0", "M8_p","M8_q","M8_p1", "M8_w","M0_PSS","M1_PSS","M2_PSS","M3_PSS","M7_PSS","M8_PSS")
colnames(PositiveSelectionTable) <- c("ID","Species","M0_lnL","M0_np", "M0_w","M1_lnL","M1_np", "M1_p0", "M1_p1", "M1_w0", "M1_w1", "M2_lnL","M2_np", "M3_lnL","M3_np","M7_lnL","M7_np", "M7_p","M7_q","M8_lnL","M8_np", "M8_p0", "M8_p","M8_q","M8_p1", "M8_w","M0_PSS","M1_PSS","M2_PSS","M3_PSS","M7_PSS","M8_PSS")
View(PositiveSelectionTable)
###Positive Slection ####
PositiveSelectionTableID <- PositiveSelectionTable %>%   left_join(Dictionary,by=c(ID="ID"))
library(dplyr)
library(ggplot2)
library(caret)
library(reshape2)
library(ggpubr)
library(RColorBrewer)
library(stringr)
library(viridis)
library(ggpubr)
library(rstatix)
library(dplyr)
library(ggplot2)
library(caret)
library(reshape2)
library(ggpubr)
library(RColorBrewer)
library(stringr)
library(viridis)
library(ggpubr)
library(rstatix)
PositiveSelectionTableID <- PositiveSelectionTable %>%   left_join(Dictionary,by=c(ID="ID"))
test <- PositiveSelectionTable %>% rowwise() %>%
mutate(M0_M3_DoF=(M3_np-M0_np)) %>%
mutate(M0_M3_LRT=2*(M3_lnL-M0_lnL)) %>%
mutate(M1_M2_DoF=(M2_np-M1_np)) %>%
mutate(M1_M2_LRT=2*(M2_lnL-M1_lnL)) %>%
mutate(M7_M8_DoF=(M8_np-M7_np)) %>%
mutate(M7_M8_LRT=2*(M8_lnL-M7_lnL)) %>%
mutate(M0_M3_sig = pchisq(M0_M3_LRT, M0_M3_DoF, lower.tail=F)) %>%
mutate(M1_M2_sig = pchisq(M1_M2_LRT, M1_M2_DoF, lower.tail=F)) %>%
mutate(M7_M8_sig = pchisq(M7_M8_LRT, M7_M8_DoF, lower.tail=F)) #%>%
#test <- adjust_pvalue(as.data.frame(test),p.col="M7_M8_sig",method="fdr")
test <- adjust_pvalue(as.data.frame(test),p.col="M7_M8_sig",method="fdr")
test2 <- adjust_pvalue(as.data.frame(test),p.col="M1_M2_sig",method="fdr")
test %>% filter(category1=="Primates") %>% ggplot(aes(x=-log10(M7_M8_sig.adj))) + geom_density() +
geom_density(data=test %>% filter(category1!="Primates"),aes(x=-log10(M7_M8_sig.adj)))
test2 %>% filter(category1=="Primates") %>% ggplot(aes(x=-log10(M1_M2_sig.adj))) + geom_density() +
geom_density(data=test2 %>% filter(category1!="Primates"),aes(x=-log10(M1_M2_sig.adj)))
test %>% filter(category1=="Primates") %>% mutate(stats=ifelse(M7_M8_sig.adj<0.05,"GUPS","noGUP")) %>% pull(stats) %>% table()
test2 %>% filter(category1=="Primates") %>% mutate(stats=ifelse(M1_M2_sig.adj<0.05,"GUPS","noGUP")) %>% pull(stats) %>% table()
test_ID <- test  %>%   left_join(Dictionary,by=c(ID="ID"))
test_ID_LTR <- test_ID %>% select(Ensembl.Gene.ID,M1_M2_LRT,M7_M8_LRT)
test_ID_lnl <- test_ID %>% select(Ensembl.Gene.ID,M7_lnL,M8_lnL)
TableS4_331_PSG_LTR <- TableS4_331_PSG %>% select(Ensembl.Gene.ID,M1avM2a_F3X4__LRT_statistic,M7vM8_F3X4__LRT_statistic, M1avM2a_F61__LRT_statistic, M7vM8_F61__LRT_statistic)
TableS4_331_PSG_lnl <- TableS4_331_PSG %>% select(Ensembl.Gene.ID,M7vM8_F3X4__null_model_lnL,M7vM8_F3X4__alternative_model_lnL)
Comparison <- TableS4_331_PSG_LTR  %>%   left_join(test_ID_LTR,by=c(Ensembl.Gene.ID="Ensembl.Gene.ID"))
ComparisonLnl <- TableS4_331_PSG_lnl  %>%   left_join(test_ID_lnl,by=c(Ensembl.Gene.ID="Ensembl.Gene.ID"))
PositiveSelectionTableID <- PositiveSelectionTable %>%   left_join(Dictionary,by=c(ID="ID"))
test <- PositiveSelectionTable %>% rowwise() %>%
mutate(M0_M3_DoF=(M3_np-M0_np)) %>%
mutate(M0_M3_LRT=2*(M3_lnL-M0_lnL)) %>%
mutate(M1_M2_DoF=(M2_np-M1_np)) %>%
mutate(M1_M2_LRT=2*(M2_lnL-M1_lnL)) %>%
mutate(M7_M8_DoF=(M8_np-M7_np)) %>%
mutate(M7_M8_LRT=2*(M8_lnL-M7_lnL)) %>%
mutate(M0_M3_sig = pchisq(M0_M3_LRT, M0_M3_DoF, lower.tail=F)) %>%
mutate(M1_M2_sig = pchisq(M1_M2_LRT, M1_M2_DoF, lower.tail=F)) %>%
mutate(M7_M8_sig = pchisq(M7_M8_LRT, M7_M8_DoF, lower.tail=F)) #%>%
#test <- adjust_pvalue(as.data.frame(test),p.col="M7_M8_sig",method="fdr")
test <- adjust_pvalue(as.data.frame(test),p.col="M7_M8_sig",method="fdr")
test2 <- adjust_pvalue(as.data.frame(test),p.col="M1_M2_sig",method="fdr")
View(PositiveSelectionTable)
View(test)
PositiveSelectionTableID <- PositiveSelectionTable %>%   left_join(Dictionary,by=c(ID="ID"))
test <- PositiveSelectionTable %>% rowwise() %>%
mutate(M0_M3_DoF=(M3_np-M0_np)) %>%
mutate(M0_M3_LRT=2*(M3_lnL-M0_lnL)) %>%
mutate(M1_M2_DoF=(M2_np-M1_np)) %>%
mutate(M1_M2_LRT=2*(M2_lnL-M1_lnL)) %>%
mutate(M7_M8_DoF=(M8_np-M7_np)) %>%
mutate(M7_M8_LRT=2*(M8_lnL-M7_lnL)) %>%
mutate(M0_M3_sig = pchisq(M0_M3_LRT, M0_M3_DoF, lower.tail=F)) %>%
mutate(M1_M2_sig = pchisq(M1_M2_LRT, M1_M2_DoF, lower.tail=F)) %>%
mutate(M7_M8_sig = pchisq(M7_M8_LRT, M7_M8_DoF, lower.tail=F)) #%>%
#test <- adjust_pvalue(as.data.frame(test),p.col="M7_M8_sig",method="fdr")
test <- adjust_pvalue(as.data.frame(test),p.col="M7_M8_sig",method="fdr")
test2 <- adjust_pvalue(as.data.frame(test),p.col="M1_M2_sig",method="fdr")
# test %>% filter(category1=="Primates") %>% ggplot(aes(x=-log10(M7_M8_sig.adj))) + geom_density() +
#   geom_density(data=test %>% filter(category1!="Primates"),aes(x=-log10(M7_M8_sig.adj)))
#
# test2 %>% filter(category1=="Primates") %>% ggplot(aes(x=-log10(M1_M2_sig.adj))) + geom_density() +
#   geom_density(data=test2 %>% filter(category1!="Primates"),aes(x=-log10(M1_M2_sig.adj)))
test  %>% mutate(stats=ifelse(M7_M8_sig.adj<0.05,"GUPS","noGUP")) %>% pull(stats) %>% table()
test2 %>% mutate(stats=ifelse(M1_M2_sig.adj<0.05,"GUPS","noGUP")) %>% pull(stats) %>% table()
View(PositiveSelectionTable)
test <- PositiveSelectionTable %>% rowwise() %>%
mutate(M0_M3_DoF=(M3_np-M0_np)) %>%
mutate(M0_M3_LRT=2*(M3_lnL-M0_lnL)) %>%
mutate(M1_M2_DoF=(M2_np-M1_np)) %>%
mutate(M1_M2_LRT=2*(M2_lnL-M1_lnL)) %>%
mutate(M7_M8_DoF=(M8_np-M7_np)) %>%
mutate(M7_M8_LRT=2*(M8_lnL-M7_lnL)) %>%
mutate(M0_M3_sig = pchisq(M0_M3_LRT, M0_M3_DoF, lower.tail=F)) %>%
mutate(M1_M2_sig = pchisq(M1_M2_LRT, M1_M2_DoF, lower.tail=F)) %>%
mutate(M7_M8_sig = pchisq(M7_M8_LRT, M7_M8_DoF, lower.tail=F)) #%>%
#test <- adjust_pvalue(as.data.frame(test),p.col="M7_M8_sig",method="fdr")
test <- adjust_pvalue(as.data.frame(test),p.col="M7_M8_sig",method="fdr")
test2 <- adjust_pvalue(as.data.frame(test),p.col="M1_M2_sig",method="fdr")
View(test)
test  %>% mutate(stats=ifelse(M7_M8_sig.adj<0.05,"GUPS","noGUP")) %>% pull(stats) %>% table()
test2 %>% mutate(stats=ifelse(M1_M2_sig.adj<0.05,"GUPS","noGUP")) %>% pull(stats) %>% table()
View(test)
View(test2)
View(test)
View(test2)
#test %>% filter(category2=="Eurhabditis") %>% mutate(stats=ifelse(M7_M8_sig.adj<0.05,"GUPS","noGUP")) %>% pull(stats) %>% table()
#Posprim <- test %>% filter(M7_M8_sig < 0.05 & M8_w > 1)
Posprim <- test_ID %>% filter(M7_M8_sig.adj < 0.05 & M8_w > 1)
#test %>% filter(category2=="Eurhabditis") %>% mutate(stats=ifelse(M7_M8_sig.adj<0.05,"GUPS","noGUP")) %>% pull(stats) %>% table()
#Posprim <- test %>% filter(M7_M8_sig < 0.05 & M8_w > 1)
Posprim <- test %>% filter(M7_M8_sig.adj < 0.05 & M8_w > 1)
View(Posprim)
PosprimM1_M2 <- test2 %>% filter(M1_M2_sig < 0.05 &  M1_w0 > 1)
View(PosprimM1_M2)
# Purprim <- test_ID %>% filter(M1_M2_sig < 0.05 & M1_p0 > 0.9 & M1_w0 < 0.05)
# Overlap <- TableS4_331_PSG %>%   left_join(Posprim,by=c(Ensembl.Gene.ID="Ensembl.Gene.ID"))
# OriginalOverlap <- TableS4_331_PSG %>%   left_join(PositiveSelectionTableID,by=c(Ensembl.Gene.ID="Ensembl.Gene.ID"))
write.table(Posprim %>% pull(ID),file="~/PhD/Code/AL/0_PaperII/AC-PS000001_Positive_selection_9_primates_V2/Final_table_positive_selection/GenesUnderPositiveSelectionPrimates.txt", quote = F,row.names = F,col.names = F)
# Purprim <- test_ID %>% filter(M1_M2_sig < 0.05 & M1_p0 > 0.9 & M1_w0 < 0.05)
# Overlap <- TableS4_331_PSG %>%   left_join(Posprim,by=c(Ensembl.Gene.ID="Ensembl.Gene.ID"))
# OriginalOverlap <- TableS4_331_PSG %>%   left_join(PositiveSelectionTableID,by=c(Ensembl.Gene.ID="Ensembl.Gene.ID"))
write.table(Posprim %>% pull(ID),file="../Final_table_positive_selection/GenesUnderPositiveSelectionPrimates.txt", quote = F,row.names = F,col.names = F)
Posprim <- test %>% filter(M7_M8_sig.adj < 0.05 & M8_w > 1)
PosprimM1_M2 <- test2 %>% filter(M1_M2_sig < 0.05 &  M1_w0 > 1)
# Purprim <- test_ID %>% filter(M1_M2_sig < 0.05 & M1_p0 > 0.9 & M1_w0 < 0.05)
# Overlap <- TableS4_331_PSG %>%   left_join(Posprim,by=c(Ensembl.Gene.ID="Ensembl.Gene.ID"))
# OriginalOverlap <- TableS4_331_PSG %>%   left_join(PositiveSelectionTableID,by=c(Ensembl.Gene.ID="Ensembl.Gene.ID"))
write.table(Posprim %>% pull(ID),file="../Final_table_positive_selection/List_GUPS.txt", quote = F,row.names = F,col.names = F)
write.table(Posprim ,file="../Final_table_positive_selection/GenesUnderPositiveSelection.txt", quote = F,row.names = F,col.names = T)
####Branch####
#Branch_models_Table <- read.delim("~/PhD/Data/Nematode_Data/z17_Positive_Selection_Table_AC-B0000192/Branch_models_BranchSite_models_Table.txt", stringsAsFactors=FALSE)
Branch_models_Table <- read.delim("../Final_table_positive_selection/Branch_models_BranchSite_models_Table.txt", header=FALSE, stringsAsFactors=TRUE)
library(dplyr)
library(ggplot2)
library(caret)
library(reshape2)
library(ggpubr)
library(RColorBrewer)
library(stringr)
library(viridis)
library(ggpubr)
library(rstatix)
####Branch####
#Branch_models_Table <- read.delim("~/PhD/Data/Nematode_Data/z17_Positive_Selection_Table_AC-B0000192/Branch_models_BranchSite_models_Table.txt", stringsAsFactors=FALSE)
Branch_models_Table <- read.delim("./Final_table_positive_selection/Branch_models_BranchSite_models_Table.txt", header=FALSE, stringsAsFactors=TRUE)
library(dplyr)
library(ggplot2)
library(caret)
library(reshape2)
library(ggpubr)
library(RColorBrewer)
library(stringr)
library(viridis)
library(ggpubr)
library(rstatix)
library(dplyr)
library(ggplot2)
library(caret)
library(reshape2)
library(ggpubr)
library(RColorBrewer)
library(stringr)
library(viridis)
library(ggpubr)
library(rstatix)
####Branch####
Branch_models_Table <- read.delim("../Final_table_positive_selection/Branch_models_BranchSite_models_Table.txt", header=FALSE, stringsAsFactors=TRUE)
colnames(Branch_models_Table) <- c("ID","SP","M0_lnL","M0_np", "bsM0_lnL",	"bsM0_np",	"bsM0H0_lnL", "bsM0H0_np",	"bsM0H1_lnL",	"bsM0H1_np")
BS_analysis <- Branch_models_Table %>% rowwise() %>%
mutate(M0_bM0_DoF=(bsM0_np-M0_np)) %>%
mutate(M0_bM0_LRT=2*(bsM0_lnL-M0_lnL)) %>%
mutate(bsM0H1_bsM0H0_DoF=(bsM0H1_np-bsM0H0_np)) %>%
mutate(bsM0H1_bsM0H0_LRT=2*(bsM0H1_lnL-bsM0H0_lnL)) %>%
mutate(M0_bM0_sig = pchisq(M0_bM0_LRT, M0_bM0_DoF, lower.tail=F)) %>%
mutate(bsM0H1_bsM0H0_sig = pchisq(bsM0H1_bsM0H0_LRT, bsM0H1_bsM0H0_DoF, lower.tail=F)) #%>%
Branch_model <- adjust_pvalue(as.data.frame(BS_analysis),p.col="M0_bM0_sig",method="fdr")
Branch_site <- adjust_pvalue(as.data.frame(BS_analysis),p.col="bsM0H1_bsM0H0_sig",method="fdr")
Branch_model <-Branch_model %>% filter(M0_bM0_sig.adj < 0.05)
Branch_site <- Branch_site %>% filter(bsM0H1_bsM0H0_sig.adj < 0.05)
write.table(Branch_model ,file="./Final_table_positive_selection/Branch_model.txt", quote = F,row.names = F,col.names = T)
Branch_model <-Branch_model %>% filter(M0_bM0_sig.adj < 0.05)
Branch_site <- Branch_site %>% filter(bsM0H1_bsM0H0_sig.adj < 0.05)
write.table(Branch_model ,file="../Final_table_positive_selection/Branch_model.txt", quote = F,row.names = F,col.names = T)
write.table(Branch_site ,file="../Final_table_positive_selection/Branch_site_model.txt", quote = F,row.names = F,col.names = T)
write.table(Branch_model %>% rowwise() %>% mutate(ID=unlist(strsplit(ID,split="_"))[2]) %>% pull(ID),file="../Final_table_positive_selection/Branch_model_ID.txt", quote = F,row.names = F,col.names = F)
